<!--


 Build.xml for tomcat environment, vaadin applications
 daniel stieger, spring 2015, brighton

 
 
 
 set JAVA_HOME=c:\javaexe\MPS30\jre
 set PATH=%PATH%;c:\javaexe\ant_MPS25\bin;c:\PROGRA~2\WIXTOO~1.7\bin
 
 
 export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home
 export PATH=$PATH:/Users/danielstieger/javaexe/ant/bin
 export PATH=$PATH:/Users/danielstieger/javaexe/maven/bin
 
 
-->
 
<project name="VaadinApplication" default="default">      
  <echo>
    Run by : ${user.name}
    Java Home : ${java.home}
  </echo>

  <!-- ************************************************************************************************** -->
  <!-- **** project specific definitions **************************************************************** -->
  <!-- ************************************************************************************************** -->
 
  <property name="appName" value="SimpleApplication" />
  <property name="appMainClass" value="Simple.baseApp.SimpleApplication" />
  <property name="appConfiguration" value="Simple/baseApp/VaadinConfig.xml" />
  <property name="appClassesGen" value="/Users/danielstieger/javaware/simpleone/solutions/Simple/classes_gen" /> 

  <property name="appClassesGen2" value="/Users/danielstieger/moware/vaadinforms/solutions/org.modellwerkstatt.vaadinforms/classes_gen" /> 
  
  <property name="tomcatDeployDir" value="/Users/danielstieger/stuff/apache-tomcat-8.0.8/webapps/${appName}" />
  <property name="mowarePluginDir" value="/Users/danielstieger/javaexe/MoPluginFake" />
  <property name="mpsHomeDir" value="/Users/danielstieger/javaexe/MPS32" />
  

  <!-- ******************************** TOMCAT Application ********************************** -->

  <target name="default">
    
    <!-- REMOVE REMOVE REMOVE           in order to get runtime packaged while developping -->
    
    <jar destfile="${mowarePluginDir}/languages/MoWareLangAndSolutions/org.modellwerkstatt.sandbox.jar"
    	 basedir="/Users/danielstieger/moware/objectflow/solutions/sandbox/classes_gen"/>
         
    <jar destfile="${mowarePluginDir}/languages/MoWareLangAndSolutions/org.modellwerkstatt.manmap.solution.jar" 
         basedir="/Users/danielstieger/moware/manmap/solutions/org.modellwerkstatt.manmap.solution/classes_gen"/>
    
    <jar destfile="${mowarePluginDir}/languages/MoWareLangAndSolutions/org.modellwerkstatt.forms.jar" 
         basedir="/Users/danielstieger/moware/forms/solutions/modellwerkstatt.forms.sandbox/classes_gen"/>
	
	
	<!-- REMOVE REMOVE REMOVE           in order to get runtime packaged while developping -->
    

    <mkdir dir="work"/>
    <mkdir dir="work/WEB-INF/lib"/>
    
    <!-- <jar destfile="work/WEB-INF/lib/moware-theme-1.0.jar" basedir="artefact/moware-theme" update="false">
    </jar> -->
    
    <copy todir="work">
      <fileset dir="artefact/moware-theme" />
    </copy>
    
    <copy todir="work/WEB-INF/lib">
    
      <fileset dir="${mowarePluginDir}/languages/MoWareLangAndSolutions/" includes="org.modellwerkstatt.sandbox.jar" />
      <fileset dir="${mowarePluginDir}/languages/MoWareLangAndSolutions/" includes="org.modellwerkstatt.manmap.solution.jar" />
      <fileset dir="${mowarePluginDir}/languages/MoWareLangAndSolutions/" includes="org.modellwerkstatt.forms.jar" />
    
      
      <fileset dir="${mowarePluginDir}/jars/" includes="org.springframework*.jar" />
      <fileset dir="${mpsHomeDir}/lib/" includes="mps-closures.jar" />
      <fileset dir="${mpsHomeDir}/lib/" includes="mps-collections.jar" />
      <fileset dir="${mowarePluginDir}/jars/" includes="joda-time*.jar" />
      <fileset dir="${mowarePluginDir}/jars/zoo/" includes="zookeeper*.jar" />
      <fileset dir="${mowarePluginDir}/jars/printing/" includes="*.jar" />
      
      
    
      <fileset dir="../jars/" includes="*.jar" />
      
    </copy>
    
    
    
    <mkdir dir="work/WEB-INF/classes"/>
    <copy todir="work/WEB-INF/classes">
      <fileset dir="${appClassesGen}" />
      <fileset dir="${appClassesGen2}" />
    </copy>
    
    <copy file="artefact/web.xml" tofile="work/WEB-INF/web.xml" filtering="yes" overwrite="yes">
      <filterchain>
          <tokenfilter>
              <replaceregex pattern="APPLICATION_FQNAME" replace="${appMainClass}"/>
              <replaceregex pattern="APPLICATION_CONFIG" replace="${appConfiguration}"/>
          
          </tokenfilter>
      </filterchain>
    </copy>
    
    <jar destfile="dist/${appName}.war" basedir="work" update="false">
      <manifest>
        <attribute name="Main-Class" value="${appMainClass}" />
        <attribute name="Version" value="${versionString}" />
      </manifest>
    </jar>

  </target>
  
  <target name="clean"
          description="Delete old work and dist directories">
    <delete dir="work"/>
  </target>
  
  <target name="redeploy" depends="default">
  	<copy todir="${tomcatDeployDir}">
  		<fileset dir="work" />
  	</copy>
  
  </target>
  
</project>